<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>🚨외국인도움</title>

<link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007BFF">

<style>
  :root{
    --box-height: 70px;
    --box-gap: 10px;
    --box-radius: 12px;
    --box-font: 14px;
    --max-width: 480px;

    --when-date-w: clamp(92px, 46vw, 120px);
    --when-time-w: clamp(62px, 28vw, 88px);

    --blue-bg: #E9F4FF;
    --orange-bg: #FFF1E6;
  }

  html { -webkit-text-size-adjust: 100%; }

  body {
    font-family: Arial, sans-serif;
    margin: 15px;
    max-width: var(--max-width);
    margin-left: auto;
    margin-right: auto;
    position: relative;
    min-height: 100vh;
    padding-bottom: 52px;
  }
  h1, h2 { text-align: center; margin: 0 0 10px 0; }

  .hyfont{
    font-family: 'HYHeadLineM','HY헤드라인M','Apple SD Gothic Neo','Noto Sans KR',system-ui,sans-serif;
    font-weight: 700;
    letter-spacing: .2px;
  }

  .hidden { display: none; }

  .multi-lang { margin: 10px 0; }
  .title-text { margin-bottom: 8px; font-weight: bold; font-size: 17px; }
  .title-text .title-line { display: block; }

  .back-button {
    background-color: #555; margin-top: 25px; width: 80%; max-width: 320px;
    padding: 12px; font-size: 14px; border: none; border-radius: 12px;
    color: white; cursor: pointer; user-select: none;
  }
  .back-button:hover { background-color: #333; }

  textarea {
    width: 100%; font-size: 14px; box-sizing: border-box; padding: 6px;
    resize: vertical; min-height: 78px; font-family: Arial, sans-serif;
  }
  .other-consult { min-height: 40px; }

  .final-wrap{ position: relative; }
  .final-summary{
    min-height: 120px;
    font-size: calc(14px + 2pt);
    color: #000;
    padding-right: 96px;
  }
  #final .note{ margin-top: 6px; font-weight: 600; color: #000; }
  #final .actions{ display: none; }
  #reset-button.inside{
    position: absolute;
    right: 8px;
    bottom: 8px;
    z-index: 1;
  }

  /* ✅ 요청사항: 8. 최종[경찰관용] 안내 문구/추가 문구를 진한 초록색 */
  #final .guideline{
    margin-top: 4px;
    font-weight: 800;
    text-decoration: none;
    color: #006400; /* dark green */
  }
  #final .extra-note{
    margin-top: 6px;
    font-size: 13px;
    font-weight: 800;
    color: #006400; /* dark green */
  }

  /* ✅ 요청사항: 캡쳐하기 버튼을 안내 문구와 같은 줄에 배치(수평) */
  #final .note-row{
    display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:6px;
  }
  #final .note-row .extra-note{ margin:0; }

  .copy-right {
    position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
    width: 100%; max-width: var(--max-width); text-align: center;
    font-size: calc(12px + 2pt);
    color: #666; padding: 8px 0; background-color: #fff;
    box-sizing: border-box; user-select: none; z-index: 1000;
  }

  .box-row {
    display: grid;
    gap: var(--box-gap);
    margin-top: var(--box-gap);
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .box-cell {
    border: 2px solid #007BFF; border-radius: var(--box-radius);
    height: var(--box-height);
    display: flex; flex-direction: column; justify-content: center; gap: 4px;
    padding: 8px 6px; box-sizing: border-box; background: var(--blue-bg);
    user-select: text; overflow: hidden;
    font-size: var(--box-font); line-height: 1.15;
    word-break: keep-all; overflow-wrap: break-word; white-space: nowrap;
    transition: background-color .12s ease, box-shadow .12s ease;
  }
  .box-cell.selected{ background: var(--orange-bg); box-shadow: inset 0 0 0 1px rgba(255,153,0,.25); }

  .box-row.bump2 .box-cell { font-size: calc(var(--box-font) + 2px); }
  .box-row.bump2 .box-cell .lang-line:first-child{
    font-weight: 700;
    border-bottom: 1px solid rgba(0,123,255,0.4);
    padding-bottom: 4px;
    margin-bottom: 4px;
  }

  .lang-line { display:block; }

  #when-cell .filter-line.when > *,
  #where-cell .filter-line.where > * { min-width: 0; }

  .filter-line.when {
    display: grid;
    grid-template-columns: minmax(0, var(--when-date-w)) minmax(0, var(--when-time-w));
    column-gap: 6px;
    justify-content: start;
    align-items: center;
    margin-top: 6px;
  }
  #when-date { width: var(--when-date-w); max-width: 100%; }
  #when-time { width: var(--when-time-w); max-width: 100%; }

  .filter-line.where {
    display: grid;
    grid-template-columns: 1fr auto;
    column-gap: 6px;
    align-items: center;
    margin-top: 6px;
  }
  #where-address { width: 100%; max-width: 100%; }
  .filter-line input[type="date"],
  .filter-line input[type="time"],
  .filter-line input[type="text"]{
    font-size: 13px; padding: 4px 6px; box-sizing: border-box;
    border: 1px solid #c6dafc; border-radius: 8px; background: #fff;
  }
  .gmaps-link{
    display: inline-block; padding: 6px 8px; text-decoration: none;
    border: 1px solid #007BFF; border-radius: 8px; font-size: 12px;
    background: #ffffff; color: #007BFF; user-select:none;
    cursor: pointer;
  }
  .gmaps-link:active { transform: translateY(1px); }

  #when-cell .lang-line:not(.ko),
  #where-cell .lang-line:not(.ko){
    font-family: Arial, 'Apple SD Gothic Neo', 'Noto Sans', 'Segoe UI', sans-serif !important;
    font-size: inherit; font-weight: 400; font-style: normal; letter-spacing: normal;
  }

  #when-cell,
  #where-cell{ height: calc(var(--box-height) * 1.5) !important; }

  /* 장소 선택 패널 */
  #where-cell.with-panel{ height: auto !important; }
  .right-actions{ display:flex; gap:6px; align-items:center; justify-content:flex-end; flex-wrap:wrap; }
  .place-panel{
    margin-top:6px; padding:6px;
    display:flex; flex-direction:column; gap:6px;
    background:#F7FBFF; border:1px solid #c6dafc; border-radius:8px;
  }
  .place-panel.hidden{ display:none; }
  .place-option{
    padding:8px 10px; border:1px solid #007BFF; border-radius:8px;
    background:#fff; font-size:14px; user-select:none; cursor:pointer;
    text-align:left;
  }

  #report .lang-line { display:none; }
  #report[data-langs~="ko"] .lang-line.ko { display:inline; }
  #report[data-langs~="en"] .lang-line.en { display:inline; }
  #report[data-langs~="zh"] .lang-line.zh { display:inline; }
  #report[data-langs~="vi"] .lang-line.vi { display:inline; }
  #report[data-langs~="uz"] .lang-line.uz { display:inline; }
  #report[data-langs~="ne"] .lang-line.ne { display:inline; }
  #report[data-langs~="ru"] .lang-line.ru { display:inline; }
  #report[data-langs~="th"] .lang-line.th { display:inline; }
  #report[data-langs~="mn"] .lang-line.mn { display:inline; }

  #report .title-text .lang-line,
  #report .box-cell .lang-line { margin-right: 6px; }

  #lang-select .lang-title{
    text-align:center;
    margin: 2px 0 12px 0;
    font-size: clamp(16px, 5vw, 20px);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    width: 100%;
  }
  #lang-select .button-list {
    display:flex; flex-direction:column; gap:12px;
    width:100%; max-width:var(--max-width); margin:10px auto 0;
    align-items:center;
  }

  /* 공용 파란 버튼 */
  #lang-select .button-list button{
    width:90%; max-width:460px; padding:12px; font-size:17px;
    border-radius:12px; border:none; background:#007BFF; color:#fff; cursor:pointer;
    box-shadow:0 3px 5px rgba(0,0,0,0.1);
    white-space: nowrap; overflow: hidden;
  }
  #lang-select .button-list button:hover{ background:#0056b3; }

  /* ✅ 메뉴얼(경찰관용) 버튼만 회색으로 (우선순위 ↑) */
  #lang-select .button-list button.manual-button{
    border:1px solid #d8d8d8;
    background:#f3f3f3;
    color:#222;
    box-shadow:0 2px 4px rgba(0,0,0,0.06);
  }
  #lang-select .button-list button.manual-button:hover{ background:#e7e7e7; }

  @media (max-width: 360px){
    :root{ --when-date-w: 96px; --when-time-w: 68px; }
    #lang-select .button-list button{ font-size:16px; }
    #lang-select .button-list button.manual-button{ font-size:16px; }
  }

  .instruction-banner{
    text-align:center;
    margin: 2px 0 10px 0;
    color:#0b64d1;
  }
  .instruction-banner .line{
    display:block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.25;
  }
  #report .instruction-banner .lang-line{ display:none; }
  #report[data-langs~="ko"] .instruction-banner .ko{ display:block; }
  #report[data-langs~="en"] .instruction-banner .en{ display:block; }
  #report[data-langs~="zh"] .instruction-banner .zh{ display:block; }
  #report[data-langs~="vi"] .instruction-banner .vi{ display:block; }
  #report[data-langs~="uz"] .instruction-banner .uz{ display:block; }
  #report[data-langs~="ne"] .instruction-banner .ne{ display:block; }
  #report[data-langs~="ru"] .instruction-banner .ru{ display:block; }
  #report[data-langs~="th"] .instruction-banner .th{ display:block; }
  #report[data-langs~="mn"] .instruction-banner .mn{ display:block; }

  /* ===== 메뉴얼 화면 스타일 ===== */
  #manual .section{
    margin: 14px 0; padding: 12px; border:1px solid #e5e5e5; border-radius:10px; background:#fafafa;
  }
  #manual h2{ font-size: 18px; margin-bottom: 6px; }

  /* ✅ 요청사항: 번호목록을 '개요' 단락처럼 왼쪽에서 시작 (1) 형식) */
  #manual .section ol{
    margin: 8px 0 0 0;
    padding: 0;
    counter-reset: item;
  }
  #manual .section ol > li{
    list-style: none;
    margin: 6px 0;
    padding-left: 0;
    line-height: 1.4;
  }
  #manual .section ol > li::before{
    counter-increment: item;
    content: counter(item) ") ";
    font-weight: 700;
  }

  .toast{
    position: fixed; bottom: 56px; left: 50%; transform: translateX(-50%);
    background: #006400; color: #fff; padding: 10px 14px; border-radius: 10px;
    font-size: 14px; z-index: 2000; opacity: 0; transition: opacity .25s;
    max-width: var(--max-width); text-align:center;
  }
  .toast.show{ opacity: 1; }
  .tip{
    margin-top:8px; padding:8px; border-left:4px solid #007BFF; background:#f4faff; font-size:14px;
  }
</style>
</head>
<body>

<!-- 메인: 언어쌍 선택 (기본 화면) -->
<div id="lang-select" class="screen">
  <div class="lang-title hyfont">[민원인에게 자국언어를 선택하게 알려주세요]</div>
  <div class="button-list">
    <button type="button" onclick="selectLangPair('en')">Report Consultation(영어)</button>
    <button type="button" onclick="selectLangPair('zh')">报案咨询(중국어)</button>
    <button type="button" onclick="selectLangPair('vi')">Tư vấn báo án(베트남어)</button>
    <button type="button" onclick="selectLangPair('uz')">Ariza bo‘yicha maslahat(우즈벡어)</button>
    <button type="button" onclick="selectLangPair('ne')">उजुरी परामर्श(네팔어)</button>
    <button type="button" onclick="selectLangPair('ru')">Консультация по заявлению(러시아어)</button>
    <button type="button" onclick="selectLangPair('th')">ปรึกษาการแจ้งความ(태국어)</button>
    <button type="button" onclick="selectLangPair('mn')">Гомдол мэдүүлэх зөвлөгөө(몽골어)</button>

    <!-- ✅ 메뉴얼(경찰관용)만 회색 버튼 -->
    <button type="button" class="manual-button" onclick="showScreen('manual')">📘 메뉴얼(경찰관용)</button>
  </div>
</div>

<!-- 신고 안내 (언어쌍 반영) -->
<div id="report" class="hidden screen" data-langs="ko en">

  <div class="instruction-banner">
    <span class="line hyfont lang-line ko">[손가락으로 경찰관에게 알려주세요]</span>
    <span class="line hyfont lang-line en">[Point with your finger and tell the police officer]</span>
    <span class="line hyfont lang-line zh">[请用手指给警察指示，并说明情况]</span>
    <span class="line hyfont lang-line vi">[Hãy chỉ tay và nói với cảnh sát]</span>
    <span class="line hyfont lang-line uz">[Barmog'ingiz bilan ko'rsatib, politsiyaga ayting]</span>
    <span class="line hyfont lang-line ne">[औंलाले देखाउँदै प्रहरीलाई बताउनुहोस्]</span>
    <span class="line hyfont lang-line ru">[Покажите пальцем и сообщите полицейскому]</span>
    <span class="line hyfont lang-line th">[โปรดชี้ด้วยนิ้วแล้วบอกเจ้าหน้าที่ตำรวจ]</span>
    <span class="line hyfont lang-line mn">[Хуруугаараа заагаад цагдаад хэлнэ үү]</span>
  </div>

  <!-- 1. 어떤 사건? -->
  <div class="multi-lang" data-section="1">
    <div class="title-text">
      <span class="title-line lang-line ko">1. 어떤 사건인가요?</span>
      <span class="title-line lang-line en">/  What happened?</span>
      <span class="title-line lang-line zh">/  发生了什么事？</span>
      <span class="title-line lang-line vi">/  Chuyện gì đã xảy ra?</span>
      <span class="title-line lang-line uz">/  Nima bo‘ldi?</span>
      <span class="title-line lang-line ne">/  के भयो?</span>
      <span class="title-line lang-line ru">/  Что случилось?</span>
      <span class="title-line lang-line th">/  เกิดอะไรขึ้น?</span>
      <span class="title-line lang-line mn">/  Юу болсон бэ?</span>
    </div>
    <div class="box-row eight-cells bump2">
      <div class="box-cell">
        <span class="lang-line ko">잃어버렸다</span><span class="lang-line en">Lost</span><span class="lang-line zh">丢失了</span><span class="lang-line vi">Bị mất</span><span class="lang-line uz">Yo‘qotdim</span><span class="lang-line ne">हराएको छ</span><span class="lang-line ru">Потерял(а)</span><span class="lang-line th">ทำหาย</span><span class="lang-line mn">Алдсан</span>
      </div>
      <div class="box-cell">
        <span class="lang-line ko">습득하였다</span><span class="lang-line en">Found</span><span class="lang-line zh">捡到了</span><span class="lang-line vi">Nhặt được</span><span class="lang-line uz">Topib oldim</span><span class="lang-line ne">फेला पर्यो</span><span class="lang-line ru">Нашёл(ла)</span><span class="lang-line th">เจอ/เก็บได้</span><span class="lang-line mn">Олсон</span>
      </div>
      <div class="box-cell">
        <span class="lang-line ko">도난당했다</span><span class="lang-line en">Was stolen</span><span class="lang-line zh">被偷了</span><span class="lang-line vi">Bị trộm</span><span class="lang-line uz">O‘g‘irlandi</span><span class="lang-line ne">चोरी भयो</span><span class="lang-line ru">Обманули/Украли</span><span class="lang-line th">ถูกขโมย</span><span class="lang-line mn">Хулгайд алдсан</span>
      </div>
      <div class="box-cell">
        <span class="lang-line ko">폭행당했다</span><span class="lang-line en">Was assaulted</span><span class="lang-line zh">被殴打了</span><span class="lang-line vi">Bị hành hung</span><span class="lang-line uz">Hujumga uchradim</span><span class="lang-line ne">कुटपिट भयो</span><span class="lang-line ru">Напали</span><span class="lang-line th">ถูกทำร้าย</span><span class="lang-line mn">Довтлуулсан</span>
      </div>
      <div class="box-cell">
        <span class="lang-line ko">교통사고 당했다</span><span class="lang-line en">Had a traffic accident</span><span class="lang-line zh">发生交通事故</span><span class="lang-line vi">Bị tai nạn giao thông</span><span class="lang-line uz">Yo‘l-transport hodisasiga uchradim</span><span class="lang-line ne">सडक दुर्घटना भयो</span><span class="lang-line ru">Попал(а) в ДТП</span><span class="lang-line th">เกิดอุบัติเหตุจราจร</span><span class="lang-line mn">Зам тээврийн осолд орсон</span>
      </div>
      <div class="box-cell">
        <span class="lang-line ko">사기 당했다</span><span class="lang-line en">Was scammed</span><span class="lang-line zh">被诈骗了</span><span class="lang-line vi">Bị lừa đảo</span><span class="lang-line uz">Firibgarlikka uchradim</span><span class="lang-line ne">ठगी भयो</span><span class="lang-line ru">Обманули</span><span class="lang-line th">ถูกหลอกลวง</span><span class="lang-line mn">Луйварт өртсөн</span>
      </div>
      <div class="box-cell">
        <span class="lang-line ko">실종되었다</span><span class="lang-line en">Went missing</span><span class="lang-line zh">失踪了</span><span class="lang-line vi">Mất tích</span><span class="lang-line uz">Bedarak yo‘qoldi</span><span class="lang-line ne">बेपत्ता भयो</span><span class="lang-line ru">Пропал(а)</span><span class="lang-line th">หายตัวไป</span><span class="lang-line mn">Алга болсон</span>
      </div>
      <div class="box-cell">
        <span class="lang-line ko">아프다</span><span class="lang-line en">I'm sick</span><span class="lang-line zh">我生病了</span><span class="lang-line vi">Bị ốm</span><span class="lang-line uz">Kasaldaman</span><span class="lang-line ne">म बिरामी छु</span><span class="lang-line ru">Я заболел(а)</span><span class="lang-line th">ฉันป่วย</span><span class="lang-line mn">Би өвдсөн</span>
      </div>
    </div>
  </div>

  <!-- 2. 언제? 어디서? -->
  <div class="multi-lang" data-section="2">
    <div class="title-text">
      <span class="title-line lang-line ko">2. 언제? 어디서?</span>
      <span class="title-line lang-line en">/  When? Where?</span>
      <span class="title-line lang-line zh">/  什么时候？在哪里？</span>
      <span class="title-line lang-line vi">/  Khi nào? Ở đâu?</span>
      <span class="title-line lang-line uz">/  Qachon? Qayerda?</span>
      <span class="title-line lang-line ne">/  कहिले? कहाँ?</span>
      <span class="title-line lang-line ru">/  Когда? Где?</span>
      <span class="title-line lang-line th">/  เมื่อไหร่? ที่ไหน?</span>
      <span class="title-line lang-line mn">/  Хэзээ? Хаана?</span>
    </div>
    <div class="box-row three-cells bump2">
      <div class="box-cell" id="when-cell">
        <span class="lang-line ko">언제</span>
        <div class="filter-line when">
          <input type="date" id="when-date" aria-label="날짜 선택">
          <input type="time" id="when-time" aria-label="시간 선택">
        </div>
        <span class="lang-line en">When</span>
        <span class="lang-line zh">什么时候</span>
        <span class="lang-line vi">Khi nào</span>
        <span class="lang-line uz">Qachon</span>
        <span class="lang-line ne">कहिले</span>
        <span class="lang-line ru">Когда</span>
        <span class="lang-line th">เมื่อไหร่</span>
        <span class="lang-line mn">Хэзээ</span>
      </div>

      <div class="box-cell" id="where-cell">
        <span class="lang-line ko">어디서</span>
        <div class="filter-line where">
          <input type="text" id="where-address" placeholder="주소 입력 / Address" aria-label="주소 입력" autocapitalize="off" autocomplete="off" spellcheck="false" inputmode="text">
          <div class="right-actions">
            <button type="button" id="place-toggle" class="gmaps-link" aria-expanded="false" aria-controls="place-panel">장소선택</button>
          </div>
        </div>

        <!-- 장소 선택 패널 -->
        <div id="place-panel" class="place-panel hidden" role="group" aria-label="장소 선택"></div>

        <span class="lang-line en">Where</span>
        <span class="lang-line zh">在哪里</span>
        <span class="lang-line vi">Ở đâu</span>
        <span class="lang-line uz">Qayerda</span>
        <span class="lang-line ne">कहाँ</span>
        <span class="lang-line ru">Где</span>
        <span class="lang-line th">ที่ไหน</span>
        <span class="lang-line mn">Хаана</span>
      </div>
    </div>
  </div>

  <!-- 3. 누가? -->
  <div class="multi-lang" data-section="3">
    <div class="title-text">
      <span class="title-line lang-line ko">3. 누가?</span>
      <span class="title-line lang-line en">/  Who?</span>
      <span class="title-line lang-line zh">/  谁？</span>
      <span class="title-line lang-line vi">/  Ai?</span>
      <span class="title-line lang-line uz">/  Kim?</span>
      <span class="title-line lang-line ne">/  को?</span>
      <span class="title-line lang-line ru">/  Кто?</span>
      <span class="title-line lang-line th">/  ใคร?</span>
      <span class="title-line lang-line mn">/  Хэн?</span>
    </div>
    <div class="box-row seven-cells bump2">
      <div class="box-cell"><span class="lang-line ko">나는(내가)</span><span class="lang-line en">I</span><span class="lang-line zh">我</span><span class="lang-line vi">Tôi</span><span class="lang-line uz">Men</span><span class="lang-line ne">म</span><span class="lang-line ru">Я</span><span class="lang-line th">ฉัน</span><span class="lang-line mn">Би</span></div>
      <div class="box-cell"><span class="lang-line ko">친구가</span><span class="lang-line en">My friend</span><span class="lang-line zh">朋友</span><span class="lang-line vi">Bạn tôi</span><span class="lang-line uz">Do‘stim</span><span class="lang-line ne">मेरो साथी</span><span class="lang-line ru">Мой 친구</span><span class="lang-line th">เพื่อนของฉัน</span><span class="lang-line mn">Миний найз</span></div>
      <div class="box-cell"><span class="lang-line ko">직장동료가</span><span class="lang-line en">Coworker</span><span class="lang-line zh">同事</span><span class="lang-line vi">Đồng nghiệp</span><span class="lang-line uz">Hamkasbim</span><span class="lang-line ne">मेरो सहकर्मी</span><span class="lang-line ru">Коллега</span><span class="lang-line th">เพื่อนร่วมงาน</span><span class="lang-line mn">Хамт ажиллагч</span></div>
      <div class="box-cell"><span class="lang-line ko">남편이</span><span class="lang-line en">My husband</span><span class="lang-line zh">丈夫</span><span class="lang-line vi">Chồng tôi</span><span class="lang-line uz">Erim</span><span class="lang-line ne">मेरो श्रीमान</span><span class="lang-line ru">Мой муж</span><span class="lang-line th">สามีของฉัน</span><span class="lang-line mn">Миний нөхөр</span></div>
      <div class="box-cell"><span class="lang-line ko">부인이</span><span class="lang-line en">My wife</span><span class="lang-line zh">妻子</span><span class="lang-line vi">Vợ tôi</span><span class="lang-line uz">Xotinim</span><span class="lang-line ne">मेरो श्रीमती</span><span class="lang-line ru">Моя жена</span><span class="lang-line th">ภรรยาของฉัน</span><span class="lang-line mn">Миний эхнэр</span></div>
      <div class="box-cell"><span class="lang-line ko">자식이</span><span class="lang-line en">My child</span><span class="lang-line zh">孩子</span><span class="lang-line vi">Con tôi</span><span class="lang-line uz">Farzandim</span><span class="lang-line ne">मेरो बच्चा</span><span class="lang-line ru">Мой ребёнок</span><span class="lang-line th">ลูกของฉัน</span><span class="lang-line mn">Миний хүүхэд</span></div>
      <div class="box-cell"><span class="lang-line ko">모르는 사람이</span><span class="lang-line en">A stranger</span><span class="lang-line zh">陌生人</span><span class="lang-line vi">Người lạ</span><span class="lang-line uz">Begona</span><span class="lang-line ne">अपरिचित व्यक्ति</span><span class="lang-line ru">Незнакомец</span><span class="lang-line th">คนแปลกหน้า</span><span class="lang-line mn">Танихгүй хүн</span></div>
    </div>
  </div>

  <!-- 4. 무엇인가요? -->
  <div class="multi-lang" data-section="4">
    <div class="title-text">
      <span class="title-line lang-line ko">4. 무엇인가요?</span>
      <span class="title-line lang-line en">/  What is it?</span>
      <span class="title-line lang-line zh">/  它是什么？</span>
      <span class="title-line lang-line vi">/  Đó là gì?</span>
      <span class="title-line lang-line uz">/  Bu nima?</span>
      <span class="title-line lang-line ne">/  यो के हो?</span>
      <span class="title-line lang-line ru">/  Что это?</span>
      <span class="title-line lang-line th">/  มันคืออะไร?</span>
      <span class="title-line lang-line mn">/  Юу вэ?</span>
    </div>
    <div class="box-row six-cells bump2">
      <div class="box-cell"><span class="lang-line ko">이름</span><span class="lang-line en">Name</span><span class="lang-line zh">姓名</span><span class="lang-line vi">Họ và tên</span><span class="lang-line uz">Ism</span><span class="lang-line ne">नाम</span><span class="lang-line ru">Имя</span><span class="lang-line th">ชื่อ</span><span class="lang-line mn">Нэр</span></div>
      <div class="box-cell"><span class="lang-line ko">국적</span><span class="lang-line en">Nationality</span><span class="lang-line zh">国籍</span><span class="lang-line vi">Quốc tịch</span><span class="lang-line uz">Fuqaroligi</span><span class="lang-line ne">राष्ट्रियता</span><span class="lang-line ru">Гражданство</span><span class="lang-line th">สัญชาติ</span><span class="lang-line mn">Иргэншил</span></div>
      <div class="box-cell"><span class="lang-line ko">연락처</span><span class="lang-line en">Contact</span><span class="lang-line zh">联系方式</span><span class="lang-line vi">Liên hệ</span><span class="lang-line uz">Aloqa</span><span class="lang-line ne">सम्पर्क</span><span class="lang-line ru">Контакты</span><span class="lang-line th">ข้อมูลติดต่อ</span><span class="lang-line mn">Холбоо барих</span></div>
      <div class="box-cell"><span class="lang-line ko">생년월일</span><span class="lang-line en">Date of birth</span><span class="lang-line zh">出生日期</span><span class="lang-line vi">Ngày sinh</span><span class="lang-line uz">Tug‘ilgan sana</span><span class="lang-line ne">जन्ममिति</span><span class="lang-line ru">Дата рождения</span><span class="lang-line th">วันเดือนปีเกิด</span><span class="lang-line mn">Төрсөн огноо</span></div>
      <div class="box-cell"><span class="lang-line ko">집주소</span><span class="lang-line en">Home address</span><span class="lang-line zh">住址</span><span class="lang-line vi">Địa chỉ nhà</span><span class="lang-line uz">Uy manzili</span><span class="lang-line ne">घरको ठेगाना</span><span class="lang-line ru">Домашний адрес</span><span class="lang-line th">ที่อยู่บ้าน</span><span class="lang-line mn">Гэрийн хаяг</span></div>
      <div class="box-cell"><span class="lang-line ko">직업</span><span class="lang-line en">Occupation</span><span class="lang-line zh">职业</span><span class="lang-line vi">Nghề nghiệp</span><span class="lang-line uz">Kasb</span><span class="lang-line ne">पेशा</span><span class="lang-line ru">Профессия</span><span class="lang-line th">อาชีพ</span><span class="lang-line mn">Мэргэжил</span></div>
    </div>
  </div>

  <!-- 5. 무엇을? -->
  <div class="multi-lang" data-section="5">
    <div class="title-text">
      <span class="title-line lang-line ko">5. 무엇을?</span>
      <span class="title-line lang-line en">/  What?</span>
      <span class="title-line lang-line zh">/  什么？</span>
      <span class="title-line lang-line vi">/  Cái gì?</span>
      <span class="title-line lang-line uz">/  Nima?</span>
      <span class="title-line lang-line ne">/  के?</span>
      <span class="title-line lang-line ru">/  Что?</span>
      <span class="title-line lang-line th">/  อะไร?</span>
      <span class="title-line lang-line mn">/  Юу?</span>
    </div>
    <div class="box-row eight-cells bump2">
      <div class="box-cell"><span class="lang-line ko">돈</span><span class="lang-line en">Money</span><span class="lang-line zh">钱</span><span class="lang-line vi">Tiền</span><span class="lang-line uz">Pul</span><span class="lang-line ne">पैसा</span><span class="lang-line ru">Деньги</span><span class="lang-line th">เงิน</span><span class="lang-line mn">Мөнгө</span></div>
      <div class="box-cell"><span class="lang-line ko">휴대폰</span><span class="lang-line en">Mobile phone</span><span class="lang-line zh">手机</span><span class="lang-line vi">Điện thoại</span><span class="lang-line uz">Uyali telefon</span><span class="lang-line ne">मो바일 फोन</span><span class="lang-line ru">Мобильный телефон</span><span class="lang-line th">โทรศัพท์มือถือ</span><span class="lang-line mn">Гар утас</span></div>
      <div class="box-cell"><span class="lang-line ko">지갑</span><span class="lang-line en">Wallet</span><span class="lang-line zh">钱包</span><span class="lang-line vi">Ví</span><span class="lang-line uz">Hamyon</span><span class="lang-line ne">पर्स</span><span class="lang-line ru">Кошелёк</span><span class="lang-line th">กระเป๋าสตางค์</span><span class="lang-line mn">Хэтэвч</span></div>
      <div class="box-cell"><span class="lang-line ko">자동차</span><span class="lang-line en">Car</span><span class="lang-line zh">汽车</span><span class="lang-line vi">Ô tô</span><span class="lang-line uz">Avtomobil</span><span class="lang-line ne">कार</span><span class="lang-line ru">Автомобиль</span><span class="lang-line th">รถยนต์</span><span class="lang-line mn">Машин</span></div>
      <div class="box-cell"><span class="lang-line ko">오토바이</span><span class="lang-line en">Motorcycle</span><span class="lang-line zh">摩托车</span><span class="lang-line vi">Xe máy</span><span class="lang-line uz">Mototsikl</span><span class="lang-line ne">मोटरसाइकल</span><span class="lang-line ru">Мотоцикл</span><span class="lang-line th">รถจักรยานยนต์</span><span class="lang-line mn">Мотоцикл</span></div>
      <div class="box-cell"><span class="lang-line ko">자전거</span><span class="lang-line en">Bicycle</span><span class="lang-line zh">自行车</span><span class="lang-line vi">Xe đạp</span><span class="lang-line uz">Velosiped</span><span class="lang-line ne">साइकल</span><span class="lang-line ru">Велосипед</span><span class="lang-line th">จักรยาน</span><span class="lang-line mn">Дугуй</span></div>
    </div>
  </div>

  <!-- 6. 보여주세요 -->
  <div class="multi-lang" data-section="6">
    <div class="title-text">
      <span class="title-line lang-line ko">6. 보여주세요</span>
      <span class="title-line lang-line en">/  Please show</span>
      <span class="title-line lang-line zh">/  请出示</span>
      <span class="title-line lang-line vi">/  Vui lòng xuất trình</span>
      <span class="title-line lang-line uz">/  Iltimos, ko‘rsating</span>
      <span class="title-line lang-line ne">/  कृपया देखाउनुहोस्</span>
      <span class="title-line lang-line ru">/  Пожалуйста, предъявите</span>
      <span class="title-line lang-line th">/  โปรดแสดง</span>
      <span class="title-line lang-line mn">/  Үзүүлнэ үү</span>
    </div>
    <div class="box-row five-cells bump2">
      <div class="box-cell"><span class="lang-line ko">여권</span><span class="lang-line en">Passport</span><span class="lang-line zh">护照</span><span class="lang-line vi">Hộ chiếu</span><span class="lang-line uz">Pasport</span><span class="lang-line ne">राहदानी</span><span class="lang-line ru">Паспорт</span><span class="lang-line th">หนังสือเดินทาง</span><span class="lang-line mn">Паспорт</span></div>
      <div class="box-cell"><span class="lang-line ko">외국인등록증</span><span class="lang-line en">Alien Registration Card</span><span class="lang-line zh">外国人登记证</span><span class="lang-line vi">Thẻ đăng ký người nước ngoài</span><span class="lang-line uz">Chet ellik ro‘yxatga olish kartasi</span><span class="lang-line ne">विदेशी दर्ता 카드</span><span class="lang-line ru">Карта регистрации иностранца</span><span class="lang-line th">บัตรลงทะเบียนคนต่างด้าว</span><span class="lang-line mn">Гадаадын иргэний бүртгэлийн карт</span></div>
    </div>
  </div>

  <!-- 7. 기타 상담 -->
  <div class="multi-lang" data-section="7">
    <div class="title-text">
      <span class="title-line lang-line ko">7. 기타 상담</span>
      <span class="title-line lang-line en">/  Other Consultation</span>
      <span class="title-line lang-line zh">/  其他咨询</span>
      <span class="title-line lang-line vi">/  Tư vấn khác</span>
      <span class="title-line lang-line uz">/  Boshqa maslahat</span>
      <span class="title-line lang-line ne">/  अन्य परामर्श</span>
      <span class="title-line lang-line ru">/  Другие консультации</span>
      <span class="title-line lang-line th">/  ปรึกษาอื่น ๆ</span>
      <span class="title-line lang-line mn">/  Бусад зөвлөгөө</span>
    </div>
    <textarea class="other-consult" id="other-consult"
      placeholder="예: 길찾기, 괴롭힘 / ex: directions, harassment"></textarea>
  </div>

  <!-- 8. 최종 정리 -->
  <div class="multi-lang" id="final" data-section="8">
    <div class="title-text">
      <span class="title-line lang-line ko">8. 최종[경찰관용]</span>
    </div>

    <!-- ✅ 요청사항: 진한 초록색 강조 -->
    <div class="guideline">[접수 및 상담 전, 신속 초동조치 용도 / (가로)는 인적사항 재확인]</div>

    <div class="final-wrap">
      <textarea id="final-summary" class="final-summary" placeholder=""></textarea>
      <button type="button" id="reset-button" class="gmaps-link inside">다시 작성</button>
    </div>

    <!-- ✅ 요청사항: 문구와 같은 줄에 캡쳐하기 버튼 -->
    <div class="note-row">
      <div class="extra-note">[위 사항은 저장되지 않으므로 캡쳐하기를 눌러주세요]</div>
      <button type="button" id="capture-button" class="gmaps-link">캡쳐하기</button>
    </div>
  </div>

  <button type="button" class="back-button" onclick="showScreen('lang-select')">
    <span class="lang-line ko">뒤로가기</span><span aria-hidden="true"> / </span>
    <span class="lang-line en">Back</span>
    <span class="lang-line zh">返回</span>
    <span class="lang-line vi">Quay lại</span>
    <span class="lang-line uz">Orqaga</span>
    <span class="lang-line ne">फिर्ता जानुहोस्</span>
    <span class="lang-line ru">Назад</span>
    <span class="lang-line th">กลับ</span>
    <span class="lang-line mn">Буцах</span>
  </button>
</div>

<!-- ===== 메뉴얼(경찰관용) 화면 ===== -->
<div id="manual" class="hidden screen" aria-labelledby="manual-title">
  <h1 id="manual-title" class="hyfont">외국인도움 웹앱 메뉴얼(경찰관용)</h1>

  <div class="section">
    <h2>1) 개요</h2>
    <p>언어 장벽이 있는 민원인과 신속히 의사소통하기 위한 다국어 안내용 웹앱입니다. 민원인이 <b>자국어 버튼을 직접 선택</b>하여 경찰관에게 상황을 손으로 알려줄 수 있도록 설계되었습니다.</p>
    <div class="tip"><b>Tip.</b> 모든 내용은 저장되지 않습니다. 필요 시 <b>8. 최종 → 캡쳐하기</b>로 저장하세요.</div>
  </div>

  <div class="section">
    <h2>2) 사용 순서</h2>
    <ol>
      <li><b>언어 선택:</b> 첫 화면에서 민원인에게 자국 언어 선택을 안내합니다.</li>
      <li><b>어떤 사건?</b> 민원인이 해당 항목을 눌러 상황을 표시합니다(도난, 폭행 등).</li>
      <li><b>언제 / 어디서:</b> 날짜·시간을 선택 후, <b>장소선택</b>을 눌러 집/회사/상점/노상/기타를 빠르게 입력할 수 있습니다.</li>
      <li><b>누가:</b> 본인/지인/가족/모르는 사람 중 해당 인물을 선택합니다.</li>
      <li><b>무엇인가요:</b> 민원인 또는 대상자의 신원 등 필요한 인적사항을 (괄호)로 누적 표기합니다.</li>
      <li><b>무엇을:</b> 금품·물건 등 대상물을 선택합니다.</li>
      <li><b>보여주세요:</b> 상담 민원인의 여권·외국인등록증 등 제시가 필요한 증빙을 안내합니다.</li>
      <li><b>기타 상담:</b> 위 선택 사항 외 내용(길찾기, 괴롭힘 등)입니다.</li>
      <li><b>최종[경찰관용]:</b> 선택·입력된 내용이 자동 정리됩니다. <b>다시 작성</b>으로 초기화할 수 있으며, <b>캡쳐하기</b>로 공유/다운로드 저장이 가능합니다.</li>
    </ol>
  </div>

  <div class="section">
    <h2>3) 운영 팁</h2>
    <ol>
      <li><b>자동 글자 맞춤:</b> 휴대폰 별 화면 크기에 따라 글씨가 자동 조정됩니다.</li>
      <li><b>주소 입력 보조:</b> 장소선택 버튼으로 빠르게 기본 장소를 입력할 수 있습니다.</li>
      <li><b>보안/개인정보:</b> 입력 내용은 기기에 저장되지 않습니다. 필요 시 캡쳐하여 참고하세요.</li>
      <li><b>언어 전환:</b> 다른 언어로 다시 안내가 필요하면 <b>뒤로가기</b>로 언어 선택 화면으로 돌아가 새 언어를 선택하세요.</li>
      <li><b>저장 안내:</b> iPhone은 캡쳐 후 공유 시트에서 <b>“사진에 저장”</b>, Galaxy/Android는 파일이 <b>다운로드</b>로 저장되어 갤러리에 표시될 수 있습니다.</li>
    </ol>
  </div>

  <div class="section">
    <h2>4) 장애 대응</h2>
    <ol>
      <li>입력창이 열리지 않으면 입력칸을 한번 더 탭하거나, 화면을 스크롤 후 다시 시도하세요.</li>
      <li>날짜/시간 선택기가 보이지 않으면 해당 칸을 탭하면 자동으로 전환됩니다.</li>
      <li>글자가 겹치면 화면 회전을 잠시 해제하거나 확대해서 확인하세요.</li>
    </ol>
  </div>

  <!-- 메뉴얼 화면의 뒤로가기 -->
  <button type="button" class="back-button" onclick="showScreen('lang-select')">
    <span class="lang-line ko">뒤로가기</span>
  </button>
</div>

<div class="copy-right">Copyright © 영암경찰서 범죄예방대응과</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
  /* 화면 전환 */
  function showScreen(id) {
    ['lang-select','report','manual'].forEach(s => {
      const el = document.getElementById(s);
      if (el) el.classList.add('hidden');
    });
    const target = document.getElementById(id);
    if (target) target.classList.remove('hidden');
    requestFitAll();
    fitAdaptiveOneLines();
  }

  /* ===== 텍스트 자동 축소 ===== */
  const MIN_FONT_PX = 12;
  const STEP = 0.5;
  const MAX_ITER = 60;

  function fits(el){
    return el.scrollHeight <= el.clientHeight && el.scrollWidth <= el.clientWidth;
  }
  function fitOneCell(cell){
    cell.classList.remove('grow-height');
    cell.style.fontSize = '';
    let computed = parseFloat(getComputedStyle(cell).fontSize);
    let iter = 0;
    while(!fits(cell) && computed > MIN_FONT_PX && iter < MAX_ITER){
      computed = Math.max(MIN_FONT_PX, computed - STEP);
      cell.style.fontSize = computed + 'px';
      iter++;
    }
    if(!fits(cell)){ cell.classList.add('grow-height'); }
  }
  function fitAllCells(){
    document.querySelectorAll('.box-cell').forEach(fitOneCell);
  }
  let fitTimer = null;
  function requestFitAll(){
    if (fitTimer) cancelAnimationFrame(fitTimer);
    fitTimer = requestAnimationFrame(fitAllCells);
  }

  /* ===== 한 줄 강제 축소 유틸 ===== */
  function fitOneLine(el){
    if (!el) return;
    el.style.fontSize = '';
    let size = parseFloat(getComputedStyle(el).fontSize) || 16;
    let tries = 0;
    while(el.scrollWidth > el.clientWidth && size > MIN_FONT_PX && tries < MAX_ITER){
      size = Math.max(MIN_FONT_PX, size - STEP);
      el.style.fontSize = size + 'px';
      tries++;
    }
  }
  function fitAdaptiveOneLines(){
    document.querySelectorAll('.instruction-banner .line').forEach(fitOneLine);
    fitOneLine(document.querySelector('#lang-select .lang-title'));
  }

  window.addEventListener('resize', () => { requestFitAll(); fitAdaptiveOneLines(); });

  /* ====== 선택 기록 ====== */
  const selectionMap = {};
  let currentPair = ['ko','en'];

  function getKoTextFromCell(cell){
    const ko = cell.querySelector('.lang-line.ko');
    return ko ? ko.textContent.trim() : '';
  }
  function getPairTextFromCell(cell){
    const out = [];
    currentPair.forEach(code=>{
      const s = cell.querySelector('.lang-line.'+code);
      if (s) out.push(s.textContent.trim());
    });
    return out.join(' / ');
  }

  /* ===== 최종 정리 업데이트 (4번은 (괄호)로 누적 표시) ===== */
  function updateFinalSummary(){
    const parts = [];
    [1,2,3].forEach(i=>{
      const v = selectionMap[i];
      if (v) parts.push(v);
    });
    const arr4 = selectionMap[4];
    if (Array.isArray(arr4) && arr4.length){
      parts.push(arr4.map(txt => `(${txt})`).join(' '));
    }
    const v5 = selectionMap[5];
    if (v5) parts.push(v5);
    const box = document.getElementById('final-summary');
    if (box) box.value = parts.filter(Boolean).join(' + ');
  }

  document.addEventListener('click', (e)=>{
    const cell = e.target.closest('.box-cell');
    if(!cell) return;
    const row = cell.parentElement;
    if(!row || !row.classList.contains('box-row')) return;
    const sectionEl = cell.closest('.multi-lang');
    const section = sectionEl ? sectionEl.getAttribute('data-section') : null;
    if (!section || section === '2') return; // 2번은 입력값 기반

    if (section === '6'){
      row.querySelectorAll('.box-cell').forEach(c => c.classList.remove('selected'));
      cell.classList.add('selected');
      return;
    }

    if (section === '4'){
      sectionEl.querySelectorAll('.box-cell.selected').forEach(c => c.classList.remove('selected'));
      cell.classList.add('selected');
      const txt = getKoTextFromCell(cell);
      if (!selectionMap[4]) selectionMap[4] = [];
      selectionMap[4].push(txt);
      updateFinalSummary();
      return;
    }

    row.querySelectorAll('.box-cell').forEach(c => c.classList.remove('selected'));
    cell.classList.add('selected');
    selectionMap[section] = getKoTextFromCell(cell);
    updateFinalSummary();
  });

  /* ===== 언어쌍 선택 → 화면2에 적용 ===== */
  const addrPH = {
    en: '장소 입력 / Address',
    zh: '장소 입력 / 地址',
    vi: '장소 입력 / Địa chỉ',
    uz: '장소 입력 / Manzil',
    ne: '장소 입력 / ठेगाना',
    ru: '장소 입력 / Адрес',
    th: '장소 입력 / ที่อยู่',
    mn: '장소 입력 / Хаяг'
  };
  const otherPH = {
    en: '예: 길찾기, 괴롭힘 / ex: directions, harassment',
    zh: '예: 길찾기, 괴롭힘 / 例如: 问路、骚扰',
    vi: '예: 길찾기, 괴롭힘 / VD: chỉ đường, quấy rối',
    uz: '예: 길찾기, 괴롭힘 / Masalan: yo‘l so‘rash, bezorilik',
    ne: '예: 길찾기, 괴롭힘 / उदाहरण: बाटो सोध्ने, दुर्व्यवहार',
    ru: '예: 길찾기, 괴롭힘 / например: маршрут, домогательства',
    th: '예: 길찾기, 괴롭힘 / เช่น: ขอเส้นทาง, การคุกคาม',
    mn: '예: 길찾기, 괴롭힘 / жишээ: зам заах, дарамт'
  };

  function setReportLangs(pair){
    currentPair = pair;
    const report = document.getElementById('report');
    report.setAttribute('data-langs', pair.join(' '));

    const second = pair.find(l => l !== 'ko') || 'en';
    const addr = document.getElementById('where-address');
    const other = document.getElementById('other-consult');
    if (addr && addrPH[second]) addr.placeholder = addrPH[second];
    if (other && otherPH[second]) other.placeholder = otherPH[second];

    // 입력칸 언어 힌트
    if (addr){ addr.setAttribute('lang', second); }
    if (other){ other.setAttribute('lang', second); }

    // 장소선택 패널 갱신
    renderPlacePanel(second);
    togglePlacePanel(false);

    requestFitAll();
    fitAdaptiveOneLines();
  }

  function selectLangPair(second){
    setReportLangs(['ko', second]);
    showScreen('report');
  }

  /* 날짜/시간 placeholder */
  function setupDateTimePlaceholders(){
    const dateEl = document.getElementById('when-date');
    const timeEl = document.getElementById('when-time');

    function enablePlaceholder(el, realType, ph){
      if (!el) return;
      el.setAttribute('data-real-type', realType);

      if (!el.value){
        el.type = 'text';
        el.placeholder = ph;
      }

      el.addEventListener('focus', ()=>{
        if (el.type === 'text'){
          el.type = el.getAttribute('data-real-type');
          setTimeout(()=>{ try{ el.showPicker && el.showPicker(); }catch(e){} }, 0);
        }
      });
      el.addEventListener('blur', ()=>{
        if (!el.value){
          el.type = 'text';
          el.placeholder = ph;
        }
      });
    }

    enablePlaceholder(dateEl, 'date', '날짜 / Date');
    enablePlaceholder(timeEl, 'time', '시간 / Time');
  }

  /* ===== 2번(언제/어디서) 선택값을 최종정리에 반영 ===== */
  function formatDateTime(dateStr, timeStr){
    let out = '';
    if (dateStr) out = dateStr.replaceAll('-','.');
    if (timeStr) out += (out ? ' ' : '') + timeStr;
    return out.trim();
  }
  function handleWhenWhereChange(){
    const dateStr = (document.getElementById('when-date').value || '').trim();
    const timeStr = (document.getElementById('when-time').value || '').trim();
    const addrStr = (document.getElementById('where-address').value || '').trim();

    const dt = formatDateTime(dateStr, timeStr);
    const parts = [];
    if (dt) parts.push(dt);
    if (addrStr) parts.push(addrStr);
    selectionMap[2] = parts.join(' @ ');
    updateFinalSummary();
  }

  /* ===== 8. 다시 작성 버튼 ===== */
  function setupResetButton(){
    const btn = document.getElementById('reset-button');
    if (!btn) return;
    btn.addEventListener('click', ()=>{
      [1,2,3,4,5].forEach(k => delete selectionMap[k]);
      selectionMap[4] = [];
      const box = document.getElementById('final-summary');
      if (box) box.value = '';
      [1,2,3,4,5].forEach(sec=>{
        document.querySelectorAll(`.multi-lang[data-section="${sec}"] .box-cell.selected`)
          .forEach(el=>el.classList.remove('selected'));
      });
      const addr = document.getElementById('where-address');
      if (addr) addr.value = '';
      handleWhenWhereChange();
    });
  }

  /* ===== 장소 선택 패널 ===== */
  const PLACE_DICT = {
    en: {home:'Home', work:'Work', shop:'Store', street:'Street/Outdoor', other:'Other'},
    zh: {home:'家', work:'公司', shop:'商店', street:'路上/室外', other:'其他'},
    vi: {home:'Nhà', work:'Công ty', shop:'Cửa hàng', street:'Ngoài đường', other:'Khác'},
    uz: {home:'Uy', work:'Ish joyi', shop:"Do'kon", street:"Ko'chada", other:'Boshqa'},
    ne: {home:'घर', work:'कार्यालय', shop:'पसल', street:'बाटोमा', other:'अन्य'},
    ru: {home:'Дом', work:'Работа', shop:'Магазин', street:'На улице', other:'Другое'},
    th: {home:'บ้าน', work:'ที่ทำงาน', shop:'ร้านค้า', street:'ริมถนน', other:'อื่นๆ'},
    mn: {home:'Гэр', work:'Ажлын газар', shop:'Дэлгүүр', street:'Гудамжинд', other:'Бусад'}
  };

  function insertAddress(text){
    const input = document.getElementById('where-address');
    if(!input) return;
    input.value = text;
    input.focus();
    try { input.setSelectionRange(input.value.length, input.value.length); } catch(e){}
    handleWhenWhereChange();
  }

  function renderPlacePanel(second){
    const panel = document.getElementById('place-panel');
    const cell = document.getElementById('where-cell');
    if(!panel || !cell) return;

    panel.innerHTML = '';
    const dict = PLACE_DICT[second] || PLACE_DICT.en;

    const items = [
      {ko:'집', for: dict.home},
      {ko:'회사', for: dict.work},
      {ko:'상점', for: dict.shop},
      {ko:'노상', for: dict.street},
      {ko:'기타', for: dict.other}
    ];

    items.forEach(it=>{
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'place-option';
      const label = `${it.ko}(${it.for})`;
      btn.textContent = label;
      btn.addEventListener('click', ()=>{
        insertAddress(label);
        togglePlacePanel(false);
      });
      panel.appendChild(btn);
    });
  }

  function togglePlacePanel(show){
    const panel = document.getElementById('place-panel');
    const cell = document.getElementById('where-cell');
    const btn = document.getElementById('place-toggle');
    if(!panel || !cell || !btn) return;

    if (show){
      panel.classList.remove('hidden');
      cell.classList.add('with-panel');
    } else {
      panel.classList.add('hidden');
      cell.classList.remove('with-panel');
    }
    btn.setAttribute('aria-expanded', show ? 'true' : 'false');
    requestFitAll();
  }

  function setupPlaceUI(){
    const btn = document.getElementById('place-toggle');
    const panel = document.getElementById('place-panel');
    const addr = document.getElementById('where-address');
    if(!btn || !panel || !addr) return;

    btn.addEventListener('click', ()=>{
      const open = panel.classList.contains('hidden');
      togglePlacePanel(open);
    });

    // 입력창 포커스 시 패널은 닫힌 상태 유지 (주소 직접 입력 배려)
    addr.addEventListener('focus', ()=> togglePlacePanel(false));
  }

  /* ===== 토스트 ===== */
  function showToast(msg){
    const el = document.getElementById('toast');
    if(!el) return;
    el.textContent = msg;
    el.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> el.classList.remove('show'), 2600);
  }

  function isIOS(){ return /iP(ad|hone|od)/.test(navigator.userAgent); }
  function isAndroid(){ return /Android/i.test(navigator.userAgent); }

  /* ===== 캡쳐하기: textarea 내용을 이미지로 저장 (공유 또는 다운로드) ===== */
  function setupCaptureButton(){
    const btn = document.getElementById('capture-button');
    const ta = document.getElementById('final-summary');
    if(!btn || !ta) return;

    function wrapTextLines(ctx, text, maxWidth){
      const words = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n').split(/\s+/);
      const lines = [];
      let line = '';
      const space = ' ';
      for (let i=0;i<words.length;i++){
        const word = words[i];
        if (word.includes('\n')){
          const parts = word.split('\n');
          for (let p=0;p<parts.length;p++){
            const segment = parts[p];
            const test = line ? line + space + segment : segment;
            if (ctx.measureText(test).width <= maxWidth){
              line = test;
            } else {
              if (line) lines.push(line);
              if (ctx.measureText(segment).width > maxWidth){
                let buf = '';
                for (const ch of segment){
                  const t2 = buf + ch;
                  if (ctx.measureText(t2).width <= maxWidth){
                    buf = t2;
                  } else {
                    if (buf) lines.push(buf);
                    buf = ch;
                  }
                }
                line = buf;
              } else {
                line = segment;
              }
            }
            if (p < parts.length - 1){
              lines.push(line);
              line = '';
            }
          }
        } else {
          const test = line ? line + space + word : word;
          if (ctx.measureText(test).width <= maxWidth){
            line = test;
          } else {
            if (line) lines.push(line);
            if (ctx.measureText(word).width > maxWidth){
              let buf = '';
              for (const ch of word){
                const t2 = buf + ch;
                if (ctx.measureText(t2).width <= maxWidth){
                  buf = t2;
                } else {
                  if (buf) lines.push(buf);
                  buf = ch;
                }
              }
              line = buf;
            } else {
              line = word;
            }
          }
        }
      }
      if (line) lines.push(line);
      return lines;
    }

    function saveImage(canvas, filename){
      canvas.toBlob(async (blob)=>{
        if(!blob){ showToast('이미지 생성 실패'); return; }

        // 1) Web Share API (가능한 기기: iOS/Android 최신 브라우저/PWA)
        const file = new File([blob], filename, { type: 'image/png' });
        if (navigator.canShare && navigator.canShare({ files: [file] })){
          try{
            await navigator.share({ files: [file], title: '외국인도움', text: '최종 정리' });
            showToast('공유 시트에서 "사진에 저장"을 선택하세요.');
            return;
          }catch(e){
            // 사용자가 취소했거나 오류 → 다운로드로 폴백
          }
        }

        // 2) iOS Safari 폴백: 새 탭 열기 → 길게 눌러 사진에 저장
        if (isIOS()){
          const url = URL.createObjectURL(blob);
          window.open(url, '_blank');
          showToast('열린 이미지에서 길게 눌러 "사진에 저장"하세요.');
          setTimeout(()=> URL.revokeObjectURL(url), 60000);
          return;
        }

        // 3) 기본 폴백: 자동 다운로드 (Android/데스크톱 등)
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.download = filename;
        a.href = url;
        document.body.appendChild(a);
        a.click();
        requestAnimationFrame(()=>{
          URL.revokeObjectURL(url);
          a.remove();
        });
        showToast('이미지 파일을 저장했습니다. 갤러리에서 확인하세요.');
      }, 'image/png');
    }

    btn.addEventListener('click', ()=>{
      const text = (ta.value || '').trim() || '(내용 없음)';
      const comp = getComputedStyle(ta);
      const fontSize = parseFloat(comp.fontSize) || 16;
      const fontFamily = comp.fontFamily || 'Arial, sans-serif';
      const fontWeight = comp.fontWeight || '400';
      const lineHeight = Math.max(fontSize * 1.4, fontSize + 6);
      const padding = 16;
      const maxWidthCSS = ta.clientWidth;
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      const drawWidth = maxWidthCSS - padding * 2;

      const meas = document.createElement('canvas').getContext('2d');
      meas.font = `${fontWeight} ${fontSize}px ${fontFamily}`;
      const lines = wrapTextLines(meas, text, drawWidth);

      const canvas = document.createElement('canvas');
      const width = maxWidthCSS;
      const heightCSS = Math.round(padding * 2 + lines.length * lineHeight);
      canvas.width = Math.max(1, Math.floor(width * dpr));
      canvas.height = Math.max(1, Math.floor(heightCSS * dpr));

      const ctx = canvas.getContext('2d');
      ctx.scale(dpr, dpr);

      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, width, heightCSS);

      ctx.fillStyle = '#000000';
      ctx.font = `${fontWeight} ${fontSize}px ${fontFamily}`;
      ctx.textBaseline = 'top';
      let y = padding;
      lines.forEach(line=>{
        ctx.fillText(line, padding, y);
        y += lineHeight;
      });

      const now = new Date();
      const ymd = String(now.getFullYear()) +
                  String(now.getMonth()+1).padStart(2,'0') +
                  String(now.getDate()).padStart(2,'0');
      const hms = String(now.getHours()).padStart(2,'0') +
                  String(now.getMinutes()).padStart(2,'0') +
                  String(now.getSeconds()).padStart(2,'0');
      const filename = `final-summary-${ymd}-${hms}.png`;

      saveImage(canvas, filename);
    });
  }

  /* 초기화 */
  window.addEventListener('load', ()=>{
    setReportLangs(['ko','en']);
    setupDateTimePlaceholders();
    handleWhenWhereChange();
    setupResetButton();
    setupPlaceUI();
    setupCaptureButton(); // 캡쳐하기 버튼 활성화
    requestFitAll();
    fitAdaptiveOneLines();

    // 입력 변경 → 2번 자동 갱신
    ['when-date','when-time','where-address'].forEach(id=>{
      const el = document.getElementById(id);
      if (el){
        el.addEventListener('change', handleWhenWhereChange);
        el.addEventListener('input', handleWhenWhereChange);
      }
    });
  });
</script>

</body>
</html>